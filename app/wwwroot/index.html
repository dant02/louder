<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <h3>Player</h3>

    <button id="play">Play</button>
    <button id="stop">Stop</button>
    <hr />

    <input type="range" min="1" max="100" value="20" class="slider" id="volumeSlider" />
    <hr />

    <label for="autoPlay">Auto play</label>
    <input type="checkbox" checked id="autoPlay" />
    <hr />

    <label for="playStatus">Is playing</label>
    <input type="checkbox" disabled id="playStatus" />

    <script type="text/javascript">
        document.getElementById('play').onclick = async function (ev) {
            await fetch('/play', { method: 'POST' })
        }
        document.getElementById('stop').onclick = async function (ev) {
            await fetch('/stop', { method: 'POST' })
        }
        document.getElementById("volumeSlider").oninput = async function (ev) {
            await fetch('/volume/' + this.value, { method: 'POST' })
        }
        document.getElementById("autoPlay").onchange = async function (ev) {
            await fetch('/autoplay/' + ev.target.checked, { method: 'POST' })
        }

        let timeout = setTimeout(GetStatus, 1000);

        async function GetStatus() {
            clearTimeout(timeout);

            await fetch('/status?' + new Date().toISOString())
                .then(async result => {

                    let el = document.getElementById('playStatus');
                    try {
                        let data = await result.json();

                        el.checked = data.isPlaying;
                        el.indeterminate = false;
                    }
                    catch {
                        el.indeterminate = true;
                    }

                    timeout = setTimeout(GetStatus, 1000);
                })
        }
    </script>
</body>
</html>